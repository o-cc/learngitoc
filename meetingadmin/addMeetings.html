<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        html, body {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .contain {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color:rgba(0,0,0, .5);
        }

        .center {
            width: 40%;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .center > div {
            width: 60%;
            padding: 10px;
        }

        .center input {
            width: 100%;
            height: 1.3em;
            font-size: 1em;
            padding: 10px;
            font-size: .6em;
        }
        .txt{
            height: 2em;
            line-height: 2em;
            font-size: .9em;
            color: rgba(0, 0, 0, 0.8);
        }
        
        .right-side {
            width: 10%;
            margin-left: 2em;
            /*background-color: #ff6700;*/
        }

        .right-side>button {
            position: absolute;
            top: 40%;
            right: 10%;
            width: 20%;
            height: 3.5em;
            background-color: #fff;
            color: #222;
            border: 0;
            cursor: pointer;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            font-size: 1.5em;
        }



    </style>
</head>
<body>

<div class="contain">
    <div class="center">
        <div>
            <div>

                <div class="txt">会议标题</div>
                <input type="text" placeholder="请输入会议标题" id="title">
            </div>
            <div>
                <div class="txt">会议介绍</div>
                <input type="text" placeholder="请输入会议介绍" id="introduce">
            </div>
            <div>
                <div class="txt">会议费用</div>
                <input type="number" placeholder="请输入会议费用" id="cost">
            </div>
            <div>
                <div class="txt">举办方</div>
                <input type="text" placeholder="请输入举办方" id="committee">
            </div>
            <div>
                <div class="txt">参加人数</div>
                <input type="number" placeholder="请输入参加人数" id="attend_num">
            </div>
            <div>
                <div class="txt">报名人数</div>
                <input type="number" placeholder="请输入报名人数" id="sign_num">
            </div>
            <div>
                <div class="txt">开始时间</div>
                    <input type="date" placeholder="请输入开始时间" id="start_time">
                    <input type="text" placeholder="请输入具体时间xx:xx" id="start_hours">
            </div>
            <div>
                <div class="txt">结束时间</div>
                <input type="date" placeholder="请输入结束时间" id="end_time">
                <input type="text" placeholder="请输入具体时间xx:xx" id="end_hours">

            </div>
            <div>
                <div class="txt">截止时间</div>
                <input type="date" placeholder="请输入截止时间" id="deadline">
                <input type="text" placeholder="请输入具体时间xx:xx" id="dead_hours">
            </div>
            <div>
                <div class="txt">赞助方</div>
                <input type="text" placeholder="请输入赞助方" id="support">
            </div>
            <div>
                <div class="txt">会议地址</div>
                <input type="text" placeholder="请输入会议地址" id="address">
            </div>
            <div>
                <div class="txt">会议背景图</div>
                <input type="file" accept="image/*" id="homepage">
            </div>

            <div>
                <div class="txt">会议标题颜色</div>
                <input type="color" value="#f96e57" id="title-bg-color">
            </div>

            <div>
                <div class="txt">会议是否显示</div>
                <input type="checkbox" id="is-show" style="height: 2.5em;">
            </div>

        </div>
    </div>
    <div class="right-side">
        <button id="clear" style="color: red;">清除数据</button>
        <button id="comfrim" style="top: 65%;">确认添加</button>
    </div>

</div>


<!--<script src="scripts/checkToken.js"></script>-->

<script src="scripts/globalUrl.js"></script>
<script src="scripts/jquery/jquery.min.js"></script>
<script src="scripts/jquery/lrz.js"></script>
<script>

    $(function () {

        let all = [
            $( "#cost" ),
            $( "#deadline" ),
            $( "#dead_hours" ),
            $( "#end_time" ),
            $( "#end_hours" ),
            $( "#start_time" ),
            $( "#start_hours" ),
            $( "#title" ),
            $( "#address" )
        ];

        var meetingTitleBg = "";

        for ( var i = 0; i < all.length; i++ ){

            all[i].blur(function () {

                if( !$(this).val().length ){
                    borderRed( $(this) )
                }else {

                    resetBorder( $(this) );
                }

            })
        }

        var homepageBase64 = "";
        $( "#homepage" ).change( function () {

            lrz( this.files[ 0 ], {
                width: 300 //设置压缩参数
            } ).then( function ( rst ) {
                /* 处理成功后执行 */
                homepageBase64 = rst.base64;

            } ).catch( function ( err ) {
                /* 处理失败后执行 */
                console.log( err );
            } )

        } )

        //不能输入小于0的数值
        $( "#attend_num" ).blur(function () {

            if( Number( $( "#attend_num" ).val().trim() ) < 0 ){
                $( "#attend_num" ).val( 0 );
            }else{
                resetBorder( $(this) );
            }


        });
        $( "#cost" ).blur(function () {

            if( Number( $( "#cost" ).val().trim() ) < 0 ){
                $( "#cost" ).val( 0 );
            }

        });
        $( "#sign_num" ).blur(function () {

            if( Number( $( "#sign_num" ).val().trim() ) < 0 ){
                $( "#sign_num" ).val( 0 );
            }

        });

        //选取会议标题颜色
        $( "#title-bg-color" ).change( function() {

            $(this).click();
            meetingTitleBg = $( this ).val();
            console.log( meetingTitleBg );
        } )


        //检查时间格式
        $("#start_hours").blur(function () {

            if( !checkHour( $(this) ) ) {
                resetBorder( $(this) );
            }
        });
        $("#end_hours").blur(function () {

            if( !checkHour( $(this) ) ) {
                resetBorder( $(this) );
            }
        });
        $("#dead_hours").blur(function () {
            if( !checkHour( $(this) ) ) {
                resetBorder( $(this) );
            }
        });


        function checkHour ( attr ) {

            var reg = /^(20|21|22|23|[0-1]\d):[0-5]\d$/
            var regExp = new RegExp(reg);
            if( !regExp.test( attr.val() ) ) {
                borderRed( attr );
                return "正确的时间格式为 11:11";
            }

        }

        $("#clear").click(function () {

           $("input").val("");

        });

        function borderRed ( ele ) {
            ele.css("border", "1px solid red" );
        };

        function resetBorder( ele ) {
            
            ele.css( "border", "1px solid #ccc" );
        };

        //确认添加
        $("#comfrim").click(function () {

            for ( let i = 0; i < all.length; i++ ) {

                resetBorder( all[i] );
            }

            var temp = '';

            if(  !$("#cost").val().trim() ){
                temp = "会议费用不能为空";
                borderRed( $("#cost") );
            }

            if(  !$("#start_time").val().trim() ){
                temp = "会议开始时间不能为空";
                borderRed( $("#start_time") );

            }

            if(  !$("#end_time").val().trim() ){
                temp = "会议结束时间不能为空";
                borderRed( $("#end_time") );

            }

            if(  !$("#deadline").val().trim() ){
                temp = "会议截止时间不能为空";
                borderRed( $("#deadline") );

            }

            if ( !$( "#title" ).val().trim() ) {
                temp = "会议标题不能为空";
                borderRed( $( "#title" ) );
            }

            if( checkHour( $("#start_hours") ) ) {
                temp = checkHour( $("#start_hours") );
            }

            if( checkHour( $("#end_hours") ) ) {
                temp = checkHour( $("#end_hours") );
            }

            if( checkHour( $("#dead_hours") ) ) {
                temp = checkHour( $("#dead_hours") );
            }

            if( temp ){
                alert(temp);
                return;
            }


            if( Number( $( "#attend_num" ).val().trim() ) < 0 ){
                $( "#attend_num" ).val( 0 );
            }

            if( Number( $( "#cost" ).val().trim() ) < 0 ) {
                $( "#cost" ).val( 0 );
            }

            if( Number( $( "#sign_num" ).val().trim() ) < 0 ) {
                $( "#sign_num" ).val( 0 );
            }

            if( homepageBase64.length === 0 ) {
                alert( "请选择会议背景图片" );
                return;
            }



            $.ajax( {
                url        : globalUrl.globalUrl + "admin/meetings",
                type     : "POST",
                contentType: "application/json",
                headers    : {
                    "Authorization": window.sessionStorage.getItem( "token" )
                },
                data       : JSON.stringify( {
                    "attend_num": Number( $( "#attend_num" ).val().trim() ),
                    "committee" : $( "#committee" ).val().trim(),
                    "cost"      : Number( $( "#cost" ).val().trim() ),
                    "deadline"  : $( "#deadline" ).val().trim() +" " + $("#dead_hours").val().trim(),
                    "end_time"  : $( "#end_time" ).val().trim() +" "  + $("#end_hours").val().trim(),
                    "homepage"  : homepageBase64,
                    "introduce" : $( "#introduce" ).val().trim(),
                    "sign_num"  : Number( $( "#sign_num" ).val().trim() ),
                    "start_time": $( "#start_time" ).val().trim() +" "  + $("#start_hours").val().trim(),
                    "support"   : $( "#support" ).val().trim(),
                    "title"     : $( "#title" ).val().trim(),
                    "address"   : $( "#address" ).val().trim(),
                    "bgcolor"   : meetingTitleBg,
                    "status"    : $("#is-show").prop("checked")?"1":"0"
                } ),
                    success: function (data) {

                        if( data["errno"] !== "0" ){
                            alert( data["errmsg"] );
                            return;
                        }

                        alert( data["errmsg"] );
                        $("input").val("");
                    },
                    error: function () {
                        alert( "无法连接服务器" );

                    }
                })

        });

    })
</script>

</body>
</html>